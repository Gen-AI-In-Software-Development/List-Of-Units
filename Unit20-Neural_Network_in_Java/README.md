#  Unit20-Neural-Network_in_Java
## Introduction

In this unit, we will ask copilot to generate Java code for a problem involving a neural networks[1].

These examples use Microsoft copilot provided here: [Microsoft copilot](https://copilot.microsoft.com/).

## Use Case

CoPilot is based on neural network technology. In this example, we will ask copilot to write a simple neural network in Java.  

## Prompts and Code Critique

We will show each prompt and the resulting code generated by Copilot. We will follow each example with a short critique and rating. The ratings will be Poor, Fair, or Good.

### Example 20.1 prompt:
I would like for you to write a simple neural network in Java. The requirements are that the neural network be trainable to learn the range values of a standard two variable truth table. There are four possible combinations for the domain values: (p=0, q=0), (p=0, q=1),(p=1,q=0), and (p=1, q=1). A user of the program may enter 0,0,0,1 to train the network to learn the logical "and" operation.

The model can always be retrained. For example, if the user enters 0 1 1 0 then he or she wants to train the network to learn the XOR operation. I would like to use 10,000 iterations (using feed forward and back propagation ) to train the network.

I need each neuron to have a bias, a list of weights, and a list of inputs. In addition, each neuron will produce a single real number as output. I also require that there be two input neurons (one for each value in the truth table's domain), five hidden neurons, and one output neuron representing the range. The initial value for weights and biases will be random. You may decide what these initial weights and biases are.

There should be a menu with the following options: 0. View the truth table, 1. Provide four inputs for the range of the two input truth table, 2. Perform a single training step, 3. Perform n training steps. 10000 is a typical value for n. 4. Test with a pair of inputs. 5. Exit program.

Here is an example execution of the program that I need:

Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
0

Working with the following truth table
0.0  0.0  0.0  
0.0  1.0  0.0  
1.0  0.0  0.0  
1.0  1.0  0.0  
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
1
Enter the four results of a 4 by 2 truth table. Each value should be 0 or 1.
0 1 1 0
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
0
Working with the following truth table
0.0  0.0  0.0  
0.0  1.0  1.0  
1.0  0.0  1.0  
1.0  1.0  0.0  
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
2
After this step the error is : 0.8037225095271462

Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
3
Enter the number of training sets.
10000
After 10000 training steps, our error 0.0061667496139162885
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of doubles from a row of the truth table. These are domain values.
0 1
The range value is approximately 0.9436960462470947
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of doubles from a row of the truth table. These are domain values.
1 1
The range value is approximately 0.04579382338123964
Using a neural network to learn a truth table.
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of doubles from a row of the truth table. These are domain values.
0 0
The range value is approximately 0.06329027307191817
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of doubles from a row of the truth table. These are domain values.
1 0
The range value is approximately 0.9446770292352884
Using a neural network to learn a truth table.

Main Menu

0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network. To test XOR, enter 0  1  1  0.
2. Perform a single training step.
3. Perform n training steps. 10000 is a typical value for n.
4. Test with a pair of inputs.
5. Exit program.

### Generated Code

```
import java.util.Arrays;
import java.util.Random;
import java.util.Scanner;

class NeuralNetwork {
    private double[][] weights1, weights2;
    private double[] biases1, biases2;

    public NeuralNetwork() {
        weights1 = new double[2][5];
        weights2 = new double[5][1];
        biases1 = new double[5];
        biases2 = new double[1];

        initializeRandomly(weights1);
        initializeRandomly(weights2);
        initializeRandomly(biases1);
        initializeRandomly(biases2);
    }

    private void initializeRandomly(double[][] matrix) {
        Random rand = new Random();
        for (double[] row : matrix) {
            for (int j = 0; j < row.length; j++) {
                row[j] = rand.nextDouble();
            }
        }
    }

    private void initializeRandomly(double[] array) {
        Random rand = new Random();
        for (int i = 0; i < array.length; i++) {
            array[i] = rand.nextDouble();
        }
    }

    public double[] feedForward(double[] inputs) {
        double[] hiddenLayer = new double[5];
        for (int i = 0; i < 5; i++) {
            hiddenLayer[i] = activate(dotProduct(inputs, weights1, i) + biases1[i]);
        }

        double output = activate(dotProduct(hiddenLayer, weights2, 0) + biases2[0]);
        return new double[]{output};
    }

    private double dotProduct(double[] inputs, double[][] weights, int neuronIndex) {
        double sum = 0;
        for (int i = 0; i < inputs.length; i++) {
            sum += inputs[i] * weights[i][neuronIndex];
        }
        return sum;
    }

    private double dotProduct(double[] inputs, double[] weights, int neuronIndex) {
        return inputs[neuronIndex] * weights[neuronIndex];
    }

    private double activate(double value) {
        return 1.0 / (1.0 + Math.exp(-value));  // Sigmoid function
    }

    public void train(double[][] inputs, double[] outputs, int iterations) {
        for (int i = 0; i < iterations; i++) {
            for (int j = 0; j < inputs.length; j++) {
                double[] input = inputs[j];
                double output = outputs[j];
                trainSingleStep(input, output);
            }
        }
    }

    private void trainSingleStep(double[] inputs, double expectedOutput) {
        double[] hiddenLayer = new double[5];
        double[] hiddenLayerOutputs = new double[5];
        for (int i = 0; i < 5; i++) {
            hiddenLayer[i] = dotProduct(inputs, weights1, i) + biases1[i];
            hiddenLayerOutputs[i] = activate(hiddenLayer[i]);
        }

        double outputLayerInput = dotProduct(hiddenLayerOutputs, weights2, 0) + biases2[0];
        double output = activate(outputLayerInput);

        double outputError = expectedOutput - output;
        double outputDelta = outputError * output * (1.0 - output);

        double[] hiddenErrors = new double[5];
        double[] hiddenDeltas = new double[5];
        for (int i = 0; i < 5; i++) {
            hiddenErrors[i] = outputDelta * weights2[i][0];
            hiddenDeltas[i] = hiddenErrors[i] * hiddenLayerOutputs[i] * (1.0 - hiddenLayerOutputs[i]);
        }

        for (int i = 0; i < 5; i++) {
            weights2[i][0] += hiddenLayerOutputs[i] * outputDelta;
        }
        biases2[0] += outputDelta;

        for (int i = 0; i < 2; i++) {
            for (int j = 0; j < 5; j++) {
                weights1[i][j] += inputs[i] * hiddenDeltas[j];
            }
        }
        for (int i = 0; i < 5; i++) {
            biases1[i] += hiddenDeltas[i];
        }
    }

    public void displayTruthTable(double[] range) {
        double[][] domain = {{0, 0}, {0, 1}, {1, 0}, {1, 1}};
        for (int i = 0; i < domain.length; i++) {
            System.out.printf("%f %f %f\n", domain[i][0], domain[i][1], range[i]);
        }
    }

    public static void main(String[] args) {
        NeuralNetwork nn = new NeuralNetwork();
        Scanner scanner = new Scanner(System.in);
        double[] range = new double[4];
        int option;

        do {
            System.out.println("Main Menu");
            System.out.println("0. Display the current truth table.");
            System.out.println("1. Provide four inputs for the range of the two input truth table and build a new neural network.");
            System.out.println("2. Perform a single training step.");
            System.out.println("3. Perform n training steps.");
            System.out.println("4. Test with a pair of inputs.");
            System.out.println("5. Exit program.");
            option = scanner.nextInt();

            switch (option) {
                case 0:
                    nn.displayTruthTable(range);
                    break;
                case 1:
                    System.out.println("Enter the four results of a 4 by 2 truth table. Each value should be 0 or 1.");
                    for (int i = 0; i < 4; i++) {
                        range[i] = scanner.nextDouble();
                    }
                    nn = new NeuralNetwork(); // Reinitialize the neural network with new random weights and biases
                    break;
                case 2:
                    double[][] trainingInputs = {{0, 0}, {0, 1}, {1, 0}, {1, 1}};
                    nn.train(trainingInputs, range, 1);
                    System.out.println("Performed a single training step.");
                    break;
                case 3:
                    System.out.println("Enter the number of training steps.");
                    int steps = scanner.nextInt();
                    double[][] inputs = {{0, 0}, {0, 1}, {1, 0}, {1, 1}};
                    nn.train(inputs, range, steps);
                    System.out.printf("After %d training steps, the error is: ...\n", steps);
                    break;
                case 4:
                    System.out.println("Enter a pair of inputs.");
                    double input1 = scanner.nextDouble();
                    double input2 = scanner.nextDouble();
                    double[] result = nn.feedForward(new double[]{input1, input2});
                    System.out.printf("The range value is approximately %f\n", result[0]);
                    break;
            }
        } while (option != 5);
    }
}

```

Sample execution:
```
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
0
0.000000 0.000000 0.000000
0.000000 1.000000 0.000000
1.000000 0.000000 0.000000
1.000000 1.000000 0.000000
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
1
Enter the four results of a 4 by 2 truth table. Each value should be 0 or 1.
0 0 0 1
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
0
0.000000 0.000000 0.000000
0.000000 1.000000 0.000000
1.000000 0.000000 0.000000
1.000000 1.000000 1.000000
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
2
Performed a single training step.
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
3
Enter the number of training steps.
10000
After 10000 training steps, the error is: ...
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of inputs.
0 1
The range value is approximately 0.006266
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of inputs.
1 1
The range value is approximately 0.992061
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of inputs.
0 1
The range value is approximately 0.006266
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
1
Enter the four results of a 4 by 2 truth table. Each value should be 0 or 1.
0 1 1 0
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of inputs.
1 1
The range value is approximately 0.928455
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
3
Enter the number of training steps.
10000
After 10000 training steps, the error is: ...
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
4
Enter a pair of inputs.
1 1
The range value is approximately 0.012123
Main Menu
0. Display the current truth table.
1. Provide four inputs for the range of the two input truth table and build a new neural network.
2. Perform a single training step.
3. Perform n training steps.
4. Test with a pair of inputs.
5. Exit program.
5

Process finished with exit code 0

```

### Critique
This is not exactly what we wanted. The error is not shown as it is in the example execution. But, overall, this code is doing the job of allowing us to repeatedly train the network for different tasks. Rating: Good.

## Exercises
1. This problem is a common one to see on the web. It is a classic example of how one can train a neural network. Perhaps you can think of a training exercise that is not so common. How did Copilot perform on your new task? Poor, Fair, or Good?  

## References
[1] [This example was motivated by this blog post](https://mattmazur.com/2015/03/17/a-step-by-step-backpropagation-example/)
